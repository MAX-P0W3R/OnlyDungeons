# HTML template

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text Adventure</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/terminal.css') }}">
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
</head>
<body>
    <div class="terminal-container">
        <div class="terminal-header">
            <span class="terminal-title">ADVENTURE.EXE</span>
            <button onclick="startNewGame()">New Game</button>
            <button onclick="saveGame()">Save</button>
        </div>
        
        <div id="terminal-output" class="terminal-output">
            <div class="boot-sequence">
                <p>Initializing adventure system...</p>
                <p>Loading game world...</p>
                <p>Ready.</p>
                <p>&nbsp;</p>
                <p>Type 'start' to begin your adventure.</p>
            </div>
        </div>
        
        <div class="terminal-input-container">
            <span class="prompt">&gt;</span>
            <input 
                type="text" 
                id="command-input" 
                class="terminal-input" 
                autocomplete="off"
                autofocus
                placeholder="Enter command..."
            >
        </div>
    </div>

    <script>
        const output = document.getElementById('terminal-output');
        const input = document.getElementById('command-input');
        
        function appendOutput(text) {
            const line = document.createElement('div');
            line.className = 'output-line';
            line.textContent = text;
            output.appendChild(line);
            output.scrollTop = output.scrollHeight;
        }
        
        function startNewGame() {
            fetch('/start', { method: 'POST' })
                .then(r => r.json())
                .then(data => {
                    output.innerHTML = '';
                    appendOutput(data.output);
                });
        }
        
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const command = this.value.trim();
                if (!command) return;
                
                // Echo command
                appendOutput('> ' + command);
                this.value = '';
                
                // Send to server
                if (command.toLowerCase() === 'start') {
                    startNewGame();
                } else {
                    fetch('/command', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ command })
                    })
                    .then(r => r.json())
                    .then(data => {
                        appendOutput(data.output);
                    });
                }
            }
        });
        
        // Keep input focused
        document.addEventListener('click', () => input.focus());
    </script>
</body>
</html>
